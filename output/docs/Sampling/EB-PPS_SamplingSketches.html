<!DOCTYPE html>
<!-- Start _layouts/doc_page.html-->
<html lang="en">

<head>
<!-- Start _include/site_head.html -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="datasketches">

<title>DataSketches | </title>

<link rel="shortcut icon" href="/img/favicon.png">

<!-- original source: https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css -->
<link rel="stylesheet" href="/css/font-awesome.min.css">
<!-- original source: https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css -->
<link rel="stylesheet" href="/css/bootstrap.min.css">

<link rel="stylesheet" href="/css/fonts.css" type="text/css">

<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/header.css">
<link rel="stylesheet" href="/css/footer.css">
<link rel="stylesheet" href="/css/syntax.css">
<link rel="stylesheet" href="/css/docs.css">

<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    options: {
      enableMenu: false // Optional: hides the right-click context menu
    }
  };
</script>

<script id="MathJax-script" async 
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

<!-- original source: https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMX_HTML-full -->
<script src="/js/MathJax.js?config=TeX-AMS_HTML"></script>

<!-- original source: https://code.jquery.com/jquery.min.js -->
<script src="/js/jquery.min.js"></script>

<!-- original source: https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js -->
<script src="/js/bootstrap.min.js"></script> <!-- 3.2.0-->
<!-- End _include/site_head.html -->

</head>

<body>
<!-- Start _include/nav_bar.html -->
<div class="navbar navbar-inverse navbar-static-top ds-nav">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" style="padding-top: 0px; padding-bottom: 0px;">
        <span class="ds-small-h-logo"></span></a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="/docs/Background/TheChallenge.html">
            <span class="fa fa-info-circle"></span> DOCUMENTATION</a>
        </li>
        <li>
          <!-- Start _include/javadocs.html -->
<ul class="nav navbar-nav navbar-right ds-nav">
  <li class="dropdown ds-nav" > <!--  <img class="java-logo" src="/img/JavaLogo.png" alt="java-logo"> -->
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" style="padding: 0px 10px 0px 0px; line-height: 50px;"><span style="padding: 0px 10px 0px 0px;"> CODE DOCS<span class="caret"></span></span></a>
    <ul class="dropdown-menu ds-nav">
      <li><a href="https://apache.github.io/datasketches-java/6.2.0/">DS-Java v6.2.0 JDK 8,11</a></li>
      <li><a href="https://apache.github.io/datasketches-java/7.0.1/">DS-Java v7.0.1 JDK 17</a></li>
      <li><a href="https://apache.github.io/datasketches-java/8.0.0/">DS-Java v8.0.0 JDK 21</a></li>
      <li><a href="https://apache.github.io/datasketches-java/9.0.0/">DS-Java v9.0.0 JDK 25+</a></li>
      <li><a href="https://apache.github.io/datasketches-java/main/">DS-Java main 07c5ae9 JDK 25+</a></li>
      <li><a href="https://apache.github.io/datasketches-cpp/5.2.0/">DS-CPP v5.2.0 C++ 11</a></li>
      <li><a href="https://apache.github.io/datasketches-python/5.2.0/">DS-Python v5.2.0</a></li>
      <li><a href="https://docs.rs/datasketches/0.2.0">DS-Rust v0.2.0</a></li>
      <li><a href="https://apache.github.io/datasketches-memory/3.0.2/">DS-Memory v3.0.1 JDK 8,11</a></li>
      <li><a href="https://apache.github.io/datasketches-memory/4.1.0/">DS-Memory v4.1.0 JDK 17</a></li>
      <li><a href="https://apache.github.io/datasketches-memory/6.0.0/">DS-Memory v6.0.0 JDK 21</a></li>
      <li><a href="/api/pig/snapshot/apidocs/index.html">DS-Pig v1.1.0 JDK 8</a></li>
      <li><a href="/api/hive/snapshot/apidocs/index.html">DS-Hive v2.0.0 JDK 8</a></li>
    </ul>
  </li>
</ul>
<!-- End _include/javadocs.html -->

        </li>
        <li>
          <span style="padding: 0px 10px 0px 0px;"></span>
        </li>
        <li>
          <a href="/docs/Community/Downloads.html">
            <span class="fa fa-download"></span> DOWNLOAD</a>
        </li>
        <!--
        <li>
          <a href="/docs/Architecture/Components.html">
            <span class="fa fa-github"></span> GITHUB</a>
        </li>
        -->
        <li>
          <a href="/docs/Community/Research.html">
            <span class="fa fa-paper-plane"></span> RESEARCH</a>
        </li>
        <li>
          <a href="/docs/Community/index.html" style="padding-top: 0; padding-bottom: 0;">
            <img class="ds-small-man" src="/img/datasketches-ManWhite.svg" alt="Man in community"><span style="line-height: 50px;">COMMUNITY</span></a>
        </li>
        <li>
          <ul class="nav navbar-nav navbar-right ds-nav">
            <li class="dropdown ds-nav" >
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" style="padding-top: 0; padding-bottom: 0;"><img class="apache-logo" src="/img/feather.svg" alt="Apache feather"><span style="line-height: 50px;">Apache</span><span class="caret"></span></a>
              <ul class="dropdown-menu ds-nav">
                <li><a href="https://www.apache.org/" target="_blank">Foundation</a></li>
                <li><a href="https://www.apache.org/events/current-event" target="_blank">Events</a></li>
                <li><a href="https://www.apache.org/licenses/" target="_blank">License</a></li>
                <li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank">Privacy Policy</a></li>
                <li><a href="https://www.apache.org/foundation/thanks.html" target="_blank">Thanks</a></li>
                <li><a href="https://www.apache.org/security/" target="_blank">Security</a></li>
                <li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank">Sponsorship</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</div>
<!-- End _include/nav_bar.html -->


  <div class="container">
    <div class="row">
      <!-- Start ToC Block -->
      <div class="col-md-3">
        <div class="searchbox" style="position:relative">
          <gcse:searchbox-only></gcse:searchbox-only>
        </div>
<!-- Start _includes/toc.html -->
<!-- Computer Generated File, Do Not Edit! -->
<link rel="stylesheet" href="/css/toc.css">
<div id="toc" class="nav toc hidden-print">

  <p id="background">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_background">Background</a>
  </p>
  <div class="collapse" id="collapse_background">
    <li><a href="/docs/Background/TheChallenge.html">•The Challenge</a></li>
    <li><a href="/docs/Background/SketchOrigins.html">•Sketch Origins</a></li>
    <li><a href="/docs/Background/SketchElements.html">•Sketch Elements</a></li>
    <li><a href="/docs/Background/Presentations.html">•Presentations</a></li>
    <li><a href="https://github.com/apache/datasketches-website/tree/master/docs/pdf/DataSketches_deck.pdf">•Overview Slide Deck</a></li>
  </div>

  <p id="architecture-and-design">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_architecture_and_design">Architecture And Design</a>
  </p>
  <div class="collapse" id="collapse_architecture_and_design">
    <li><a href="/docs/Architecture/MajorSketchFamilies.html">•The Major Sketch Families</a></li>
    <li><a href="/docs/Architecture/LargeScale.html">•Large Scale Computing</a></li>
    <li><a href="/docs/Architecture/KeyFeatures.html">•Key Features</a></li>
    <li><a href="/docs/Architecture/SketchFeaturesMatrix.html">•Sketch Features Matrix</a></li>
    <li><a href="/docs/Architecture/Components.html">•Components</a></li>
    <li><a href="/docs/Architecture/SketchesByComponent.html">•Sketches by Component</a></li>
    <li><a href="/docs/Architecture/SketchCriteria.html">•Sketch Criteria</a></li>

    <p id="memory-component">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_memory_component">Memory Component</a>
    </p>
    <div class="collapse" id="collapse_memory_component">
      <li><a href="/docs/Memory/MemoryComponent.html">•Memory Component</a></li>
      <li><a href="/docs/Memory/MemoryPerformance.html">•Memory Component Performance</a></li>
    </div>
    <li><a href="/docs/Architecture/OrderSensitivity.html">•Notes on Order Sensitivity</a></li>
    <li><a href="/docs/Architecture/Concurrency.html">•Notes on Concurrency</a></li>
  </div>

  <p id="sketch-families">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_sketch_families">Sketch Families</a>
  </p>
  <div class="collapse" id="collapse_sketch_families">

    <p id="distinct-counting">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_distinct_counting">Distinct Counting</a>
    </p>
    <div class="collapse" id="collapse_distinct_counting">
      <li><a href="/docs/DistinctCountFeaturesMatrix.html">•Features Matrix</a></li>
      <li><a href="/docs/DistinctCountMeritComparisons.html">•Figures-of-Merit Comparison</a></li>
      <li><a href="/docs/CPC/CpcSketches.html">•CPC Sketches</a></li>
      <li><a href="/docs/HLL/HllSketches.html">•HyperLogLog Sketches</a></li>
      <li><a href="/docs/Theta/ThetaSketches.html">•Theta Sketches</a></li>
      <li><a href="/docs/Tuple/TupleSketches.html">•Tuple Sketches</a></li>
    </div>

    <p id="most-frequent">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_most_frequent">Most Frequent</a>
    </p>
    <div class="collapse" id="collapse_most_frequent">
      <li><a href="/docs/Frequency/FrequencySketches.html">•Frequency Sketches</a></li>
      <li><a href="/docs/Frequency/FrequencySketches.html#frequent-items-sketches">•Frequent Items Sketches</a></li>
      <li><a href="/docs/Frequency/FrequencySketches.html#frequent-distinct-tuples-sketches">•Frequent Distinct Tuples Sketches</a></li>
    </div>

    <p id="quantiles-and-histograms">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_quantiles_and_histograms">Quantiles And Histograms</a>
    </p>
    <div class="collapse" id="collapse_quantiles_and_histograms">
      <li><a href="/docs/QuantilesAll/QuantilesOverview.html">•Quantiles Overview</a></li>
      <li><a href="/docs/KLL/KLLSketch.html">•KLL Sketches</a></li>
      <li><a href="/docs/Quantiles/ClassicQuantilesSketch.html">•Classic Quantiles Sketches</a></li>
      <li><a href="/docs/REQ/ReqSketch.html">•REQ Sketch</a></li>
      <li><a href="/docs/tdigest/tdigest.html">•t-digest</a></li>
    </div>

    <p id="sampling">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_sampling">Sampling</a>
    </p>
    <div class="collapse" id="collapse_sampling">
      <li><a href="/docs/Sampling/EB-PPS_SamplingSketches.html">•EB-PPS Sampling Sketches</a></li>
      <li><a href="/docs/Sampling/ReservoirSamplingSketches.html">•Reservoir Sampling Sketches</a></li>
      <li><a href="/docs/Sampling/VarOptSamplingSketches.html">•VarOpt Sampling Sketches</a></li>
    </div>

    <p id="density-and-coresets">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_density_and_coresets">Density And Coresets</a>
    </p>
    <div class="collapse" id="collapse_density_and_coresets">
      <li><a href="/docs/Density/DensitySketch.html">•Density Sketch</a></li>
    </div>
  </div>

  <p id="system-integrations">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_system_integrations">System Integrations</a>
  </p>
  <div class="collapse" id="collapse_system_integrations">
    <li><a href="/docs/SystemIntegrations/ApacheDruidIntegration.html">•Using Sketches in Apache Druid</a></li>
    <li><a href="/docs/SystemIntegrations/ApacheHiveIntegration.html">•Using Sketches in Apache Hive</a></li>
    <li><a href="/docs/SystemIntegrations/ApachePigIntegration.html">•Using Sketches in Apache Pig</a></li>
    <li><a href="/docs/SystemIntegrations/ApachePinotIntegration.html">•Using Sketches in Apache Pinot</a></li>
    <li><a href="/docs/SystemIntegrations/GoogleBigQueryIntegration.html">•Using Sketches in Google BigQuery</a></li>
    <li><a href="/docs/SystemIntegrations/PostgreSQLIntegration.html">•Using Sketches in PostgreSQL</a></li>
  </div>

  <p id="community">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_community">Community</a>
  </p>
  <div class="collapse" id="collapse_community">
    <li><a href="/docs/Community/index.html">•Community</a></li>
    <li><a href="/docs/Community/Downloads.html">•Downloads</a></li>
    <li><a href="/docs/Community/NewCommitterProcess.html">•Committer Process</a></li>
    <li><a href="/docs/Community/ReleaseProcessForCppComponents.html">•Release Process For CPP Components</a></li>
    <li><a href="/docs/Community/ReleaseProcessForJavaComponents.html">•Release Process For Java Components</a></li>
    <li><a href="/docs/Community/Transitioning.html">•Transitioning from prior GitHub Site</a></li>
  </div>

  <p id="research">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_research">Research</a>
  </p>
  <div class="collapse" id="collapse_research">
    <li><a href="/docs/Community/Research.html">•Research</a></li>
  </div>
</div>
<!-- End _includes/toc.html -->


<!-- Start _includes/tocScript.html -->
<script>
  (function () {

    var findLineItem = function (path) {
      return document.querySelector(`#toc [href="${path}"]`);
    };

    function findNavItem(path) {
      return document.querySelector(`.nav [href="${path}"]`);
    }

    var highlighLineItem = function (element) {
      element.classList.add('highlight');
    };

    var checkHasClass = function (element, className) {
      return element.className.split(' ').find(function (item) { return item === className || '' })
    }

    var findAllCollapseParents = function (element) {
      var collapseMenus = [];
      var elementPointer = element;
      while (elementPointer !== document.body) {
        if (checkHasClass(elementPointer, 'collapse')) {
          collapseMenus.push(elementPointer);
        }
        elementPointer = elementPointer.parentElement
      }
      return collapseMenus
    };

    var openMenuItem = function (element) {
      // $(element).collapse('show') would start a transition, adding `in` class instead.
      element.classList.add('in');
    };

    var openAllFromList = function (elementList) {
      elementList.forEach(openMenuItem);
    };

    var highlightAndOpenMenu = function () {
      // Highlight & expand nav item in the TOC
      var currentLineItem = findLineItem(document.location.pathname);
      highlighLineItem(currentLineItem);
      openAllFromList(findAllCollapseParents(currentLineItem));

      // Highlight nav item in top navigation
      highlighLineItem(findNavItem(document.location.pathname));
    };

    $(highlightAndOpenMenu);

  }());
</script>
<!-- End _includes/tocScript.html -->

      </div>
      <!-- End ToC Block -->
      <div class="col-md-9 doc-content">
<!--
    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
-->
<h2 id="contents">Contents</h2>
<!-- TOC -->
<ul>
  <li><a href="#eb-pps-sampling-sketch">EB-PPS Sampling Sketches</a>
    <ul>
      <li><a href="#key-concepts-of-eb-pps">Key Concepts of EB-PPS</a></li>
      <li><a href="#computational-advantages">Computational Advantages</a></li>
      <li><a href="#applications-in-ML">Applications in Machine Learning</a></li>
      <li><a href="#eb-pps-vs-varopt1">EB-PPS versus VarOpt for large datasets</a></li>
      <li><a href="#sample-size-vs-pps-tradeoff">The fixed sample size verses PPS property tradeoff</a>
        <ul>
          <li><a href="#the-core-conflict">The Core Conflict</a></li>
          <li><a href="#fixed-sample-size">Prioritizing Fixed Sample Size (e.g., VarOpt)</a></li>
          <li><a href="#pps-property">Prioritizing the PPS Property (e.g., EB-PPS)</a></li>
          <li><a href="#summary-table">Summary Table</a></li>
        </ul>
      </li>
      <li><a href="#eb-pps-weights">How EB-PPS works with varying weights</a>
        <ul>
          <li><a href="#eb-pps-vs-varopt2">EB-PPS versus VarOpt Table </a></li>
        </ul>
      </li>
      <li><a href="#pps-for-classifiers">Situations that make PPS vital for classifier performance</a>
        <ol>
          <li><a href="#training-classifiers">Training Bayes-Optimal Classifiers</a></li>
          <li><a href="#class-imbalance">Handling Severe Class Imbalance</a></li>
          <li><a href="#probability-calibration">Maintaining Probability Calibration</a></li>
          <li><a href="#legal-ethical-fairness">Legal and Ethical Fairness</a></li>
        </ol>
      </li>
    </ul>
  </li>
</ul>

<!-- TOC -->

<p><a id="eb-pps-sampling-sketch"></a></p>
<h2 id="exact-bound-probability-proportional-to-size-eb-pps-sampling-sketches">Exact Bound Probability-Proportional-to-Size (EB-PPS) Sampling Sketches</h2>

<p>An implementation inspired by the paper:”Exact PPS Sampling with Bounded Sample Size”,
B. Hentschel, P. J. Haas, Y. Tian. Information Processing Letters, 2023.</p>

<p>The EB-PPS Sampling Sketch is a one-pass streaming algorithm that ensures Probability-Proportional-to-Size (PPS) sampling while strictly bounding the sample size to a target <em>k</em>. It maintains the exact PPS property, handles imbalanced data efficiently, and is computationally superior for large-scale applications compared to other reservoir-type sketches.</p>

<p>Key features and benefits of EB-PPA include:</p>

<ul>
  <li><strong>Sample Size Control:</strong> EB-PPS ensures the sample size never exceeds the target <em>k</em>, making it ideal for scenarios requiring strict storage or time constraints.</li>
  <li><strong>Optimal Statistical Properties:</strong> When possible, the sample size is exactly <em>k</em>, while in other cases, it maintains maximal expected value and minimal variance.</li>
  <li><strong>Efficiency:</strong> As a one-pass streaming algorithm, it is highly efficient, which is crucial for processing large, real-time, or streaming data.</li>
  <li><strong>Application in Machine Learning:</strong> This method is particularly useful for training classifiers on imbalanced datasets, where it helps in overcoming issues with biased results.</li>
  <li><strong>Comparison with Other Methods:</strong> In the above referenced paper, EB-PPS is compared to other methods such as Conditional Poisson Sampling (CPS) and Pareto PPS sampling, which also aim to have inclusion probabilities proportional to given size measures.</li>
</ul>

<p>EB-PPS is a modern sampling scheme designed to resolve a fundamental conflict in statistical sampling: the inability to simultaneously guarantee exact <strong>Probability Proportional to Size (PPS)</strong> and a fixed sample size for all datasets. It is advantageous for its simplicity, efficiency, and ability to balance the need for exact PPS with the constraint of a fixed sample size.</p>

<p><a id="key-concepts-of-eb-pps"></a></p>
<h3 id="key-concepts-of-eb-pps">Key Concepts of EB-PPS</h3>
<p>Traditional PPS schemes often prioritize keeping a fixed sample size <em>k</em>, which sometimes forces them to violate the PPS property (where each item’s selection probability must be exactly proportional to its weight). EB-PPS flips this trade-off: </p>

<ul>
  <li><strong>Strict PPS Property:</strong> It enforces the PPS property at all times, ensuring item-inclusion probabilities are exactly proportional to their weights.</li>
  <li><strong>Bounded Sample Size:</strong> It uses the target <em>k</em> as a strict upper bound rather than a fixed requirement.</li>
  <li><strong>Optimality:</strong> If the sample size cannot be exactly <em>k</em> while maintaining strict PPS, the algorithm produces a sample with the maximal possible expected size and minimal variance.</li>
</ul>

<p><a id="computational-advantages"></a></p>
<h3 id="computational-advantages">Computational Advantages</h3>

<p>EB-PPS is particularly suited for high-volume data environments and modern era big data analytics: </p>

<ul>
  <li>
    <p><strong>One-Pass Streaming:</strong> It processes items sequentially and does not need to know the total population size in advance.</p>
  </li>
  <li>
    <p><strong>Efficiency:</strong> It features an amortized processing time of <em>O(1)</em> <strong>per item</strong>, making it computationally superior to older state-of-the-art algorithms like VarOpt, which has <em>O(log k)</em> complexity.</p>
  </li>
  <li>
    <p><strong>Memory Management:</strong> By bounding the sample size, it prevents storage overflows during real-time data ingestion.</p>
  </li>
</ul>

<p><a id="applications-in-ML"></a></p>
<h3 id="applications-in-machine-learning">Applications in Machine Learning</h3>

<p>A primary modern application for EB-PPS is training classifiers on imbalanced datasets: </p>

<ul>
  <li><strong>Bayes-Optimality:</strong> By maintaining exact PPS, it allows standard training techniques (designed for 0-1 loss) to produce Bayes-optimal classifiers even when the true loss function is imbalanced.</li>
  <li><strong>Superior Performance:</strong> Research indicates that smaller, well-curated EB-PPS samples can outperform larger samples from traditional schemes (like VarOpt) because they avoid the bias introduced by violating PPS.</li>
</ul>

<p><a id="eb-pps-vs-varopt1"></a></p>
<h3 id="eb-pps-versus-varopt-for-large-datasets">EB-PPS versus VarOpt for large datasets</h3>
<p>EB-PPS is more efficient than VarOpt for large, high-volume datasets due to its superior computational complexity and optimized sample curation. Key advantages include:</p>

<ul>
  <li><strong>Optimal Computational Complexity:</strong> EB-PPS achieves an <em>O(1)</em> <strong>amortized processing time</strong> per item. This is an improvement over VarOpt, which typically requires <em>O(log k)</em> (or <em>O(log log k)</em> in some streaming implementations) time per item to maintain its internal structures.</li>
  <li><strong>Reduced Sample Size Requirements:</strong> Because EB-PPS maintains strict PPS properties, it can achieve superior results with smaller samples. Research shows EB-PPS can produce classifiers with roughly 36% less loss than VarOpt while using sample sizes that are <strong>one-third to one-half as large.</strong> Smaller samples directly translate to faster downstream analytics and lower memory overhead.</li>
  <li><strong>Simplified Data Structures:</strong> EB-PPS uses a single array of size <em>k</em> and does not require complex heap-based management, making it easier to implement and maintain in parallel systems.</li>
  <li><strong>Avoidance of Bias-Correction Overhead:</strong> VarOpt often violates exact PPS to maintain a fixed sample size, requiring complex customized loss functions or additional training procedures to correct this bias. EB-PPS avoids these secondary computational costs by ensuring inclusion probabilities are “as advertised” from the start.</li>
</ul>

<p><a id="sample-size-vs-pps-tradeoff"></a></p>
<h3 id="the-fixed-sample-size-verses-pps-property-tradeoff">The fixed sample size verses PPS property tradeoff</h3>
<p>The primary trade-off in weighted sampling remains the tension between maintaining a fixed sample size <em>k</em> and strictly adhering to the PPS property. These two goals are mathematically incompatible in many real-world datasets.</p>

<p><a id="the-core-conflict"></a></p>
<h4 id="the-core-conflict">The Core Conflict</h4>
<p>The fundamental issue arises when some items have such high weights that they “crowd out” the rest of the sample:</p>

<ul>
  <li><strong>Incompatibility:</strong> If an item’s weight is disproportionately large compared to the total weight of the population, a fixed <em>k</em> may force the algorithm to sample lower-weight items more frequently than their weight allows just to fill the <em>k</em> slots.</li>
  <li><strong>Statistical Implication:</strong> When a fixed size is prioritized, the inclusion probabilities are no longer truly proportional to size (PPS), introducing statistical bias.</li>
</ul>

<p><a id="fixed-sample-size"></a></p>
<h4 id="prioritizing-fixed-sample-size-eg-varopt">Prioritizing Fixed Sample Size (e.g., VarOpt)</h4>
<p>Most traditional PPS schemes, like VarOpt, prioritize keeping the sample size exactly at <em>k</em>.</p>

<ul>
  <li><strong>Advantage:</strong> Predictable resource consumption and downstream processing time, as the analyst knows exactly how many data points will be returned.</li>
  <li><strong>Disadvantage:</strong> Violates the PPS property when large-weight items exist. This requires complex bias-correction or specialized loss functions during model training.</li>
</ul>

<p><a id="pps-property"></a></p>
<h4 id="prioritizing-the-pps-property-eg-eb-pps">Prioritizing the PPS Property (e.g., EB-PPS)</h4>
<p>Modern approaches like EB-PPS prioritize strict adherence to the PPS property over a fixed count.</p>

<ul>
  <li><strong>Advantage:</strong> Maintains “as advertised” inclusion probabilities. This allows standard training algorithms to produce <strong>Bayes-optimal classifiers</strong> directly, which is critical for imbalanced datasets.</li>
  <li><strong>Disadvantage:</strong> The sample size becomes a variable (though bounded by <em>k</em>). The actual size may fall below <em>k</em> if strict PPS compliance necessitates a smaller, more representative sample. </li>
</ul>

<p><a id="summary-table"></a></p>
<h4 id="summary-table">Summary Table</h4>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Priority</th>
      <th style="text-align: left">Strategy</th>
      <th style="text-align: left">Consequence</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><b>Fixed Size</b></td>
      <td style="text-align: left">Fill k slots at all costs.</td>
      <td style="text-align: left">PPS property is violated; statistical bias is introduced.</td>
    </tr>
    <tr>
      <td style="text-align: left"><b>Strict PPS</b></td>
      <td style="text-align: left">Use probabilities strictly proportional to weights.</td>
      <td style="text-align: left">Sample size becomes a variable upper-bounded by <em>k</em>.</td>
    </tr>
  </tbody>
</table>

<p><a id="eb-pps-weights"></a></p>
<h3 id="how-eb-pps-works-with-varying-weights">How EB-PPS works with varying weights</h3>
<p>The algorithm’s efficiency stems from how it handles incoming items regardless of their individual “size” or weight:</p>

<ul>
  <li><strong>Flat Data Structure:</strong> EB-PPS uses only a single array of size <em>k</em> (where <em>k</em> is the target sample size). Unlike VarOpt, which relies on a heap or priority queue to manage items by weight (resulting in <em>O(log k)</em> costs), EB-PPS performs simple updates to its array.</li>
  <li><strong>Constant-Time Decision Logic:</strong> When a new item arrives with a specific weight, the algorithm performs a fixed number of arithmetic operations to determine if it should be included. These operations do not scale with the total population size or the sample size <em>k</em>.</li>
  <li><strong>Amortized Rebalancing:</strong> While most items are processed in a single step, certain items may trigger a “reweighting” or rebalancing of the internal sample. Because these events occur with predictable, low frequency relative to the total number of items, the cost is spread out (amortized) to maintain an average of <em>O(1)</em> <strong>per item</strong>.</li>
  <li><strong>Weight Independence:</strong> The computational cost remains constant whether the item has a very large weight (making it almost certain to be included) or a very small weight (making it rare). The algorithm only processes the current item’s weight against its internal state, never needing to re-sort or re-scan the entire reservoir for every new entry.</li>
</ul>

<p><a id="eb-pps-vs-varopt2"></a></p>
<h4 id="eb-pps-versus-varopt-table">EB-PPS versus VarOpt Table</h4>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Feature</th>
      <th style="text-align: left">EB-PPS</th>
      <th style="text-align: left">VarOpt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><b>Complexity per Item</b></td>
      <td style="text-align: left"><em>O(1)</em> (Amortized)</td>
      <td style="text-align: left"><em>O(log k)</em> (Standard)</td>
    </tr>
    <tr>
      <td style="text-align: left"><b>Data Structure</b></td>
      <td style="text-align: left">Simple Array</td>
      <td style="text-align: left">Priority Queue / Heap</td>
    </tr>
    <tr>
      <td style="text-align: left"><b>PPS Property</b></td>
      <td style="text-align: left"><b>Strictly enforced</b></td>
      <td style="text-align: left">Violated if necessary to fix <em>k</em></td>
    </tr>
    <tr>
      <td style="text-align: left"><b>Sample Size <em>(k)</em></b></td>
      <td style="text-align: left">Upper bound (Variable)</td>
      <td style="text-align: left">Fixed (Strict)</td>
    </tr>
  </tbody>
</table>

<p><a id="pps-for-classifiers"></a></p>
<h3 id="situations-that-make-pps-vital-for-classifier-performance">Situations that make PPS vital for classifier performance</h3>
<p>Today, strict adherence to the Probability Proportional to Size (PPS) property—as prioritized by schemes like EB-PPS—is considered vital for classifier performance in the following high-stakes scenarios:</p>

<p><a id="training-classifiers"></a></p>
<h4 id="1-training-bayes-optimal-classifiers">1: Training Bayes-Optimal Classifiers</h4>

<p>For a classifier to be truly “optimal,” it must minimize expected risk based on the data’s true underlying distribution.</p>

<ul>
  <li><strong>The PPS Link:</strong> Exact PPS sampling ensures that the training subset maintains the statistical integrity of the original dataset’s weights.</li>
  <li><strong>Direct Training:</strong> When PPS is strictly maintained, you can use standard training algorithms (optimized for 0-1 loss) to produce Bayes-optimal decision boundaries. If PPS is violated (as often happens with fixed-size schemes like VarOpt), the resulting decision boundary shifts, leading to suboptimal performance unless complex, custom loss-correction is applied.</li>
</ul>

<p><a id="class-imbalance"></a></p>
<h4 id="2-handling-severe-class-imbalance">2: Handling Severe Class Imbalance</h4>
<p>In datasets where the minority class is extremely rare (e.g., fraud detection or rare disease diagnosis), small errors in inclusion probability can cause the classifier to ignore critical but rare signals.</p>

<ul>
  <li><strong>Avoiding “Majority Bias”:</strong> Inaccurate sampling often leads a model to simply predict the majority class for all instances to achieve high “accuracy” while failing at its actual task.</li>
  <li><strong>Exact Representation:</strong> Strict PPS ensures that the weight assigned to these rare cases is exactly preserved in the sample, forcing the model to learn the minority class features correctly.</li>
</ul>

<p><a id="probability-calibration"></a></p>
<h4 id="3-maintaining-probability-calibration">3: Maintaining Probability Calibration</h4>
<p>Calibration refers to the model’s ability to provide accurate probability estimates (e.g., “there is a 70% chance of malignancy”) rather than just a 0/1 label.</p>

<ul>
  <li><strong>Clinical Utility:</strong> In healthcare, over- or under-estimating risks can lead to dangerous overtreatment or missed diagnoses.</li>
  <li><strong>PPS Advantage:</strong> Because EB-PPS does not distort the inclusion probabilities to force a fixed sample size, the resulting model is inherently better calibrated. The probabilities it outputs reflect the true risk levels of the original population.</li>
</ul>

<p><a id="legal-ethical-fairness"></a></p>
<h4 id="4-legal-and-ethical-fairness">4: Legal and Ethical Fairness</h4>
<p>Today, algorithmic fairness is a major regulatory focus. Biased sampling is a primary source of “AI bias” that leads to prejudiced outcomes in lending, hiring, or healthcare.</p>

<ul>
  <li><strong>Predictive Parity:</strong> Strict PPS allows for the construction of fair Bayes-optimal classifiers that satisfy “predictive parity,” ensuring that the model’s error rates and accuracy are consistent across different protected groups (e.g., race, gender).</li>
  <li><strong>Liability Mitigation:</strong> Using sampling methods that guarantee statistical integrity (like EB-PPS) helps developers demonstrate that their models were trained on a representative, unbiased representation of the data, reducing legal liability for “erroneous training data”.</li>
</ul>

<p><em>(Note: much of this overview was generated by Gemini AI, it may contain errors.)</em></p>

      </div> <!-- End content -->
    </div> <!-- End row -->
  </div> <!-- End Container -->

<!-- Start _include/page_footer.html -->
<footer class="ds-footer">
  <div class="container">
    <div class="text-center">
      <p>
        <div>Copyright © 2025 <a href="https://www.apache.org">Apache Software Foundation</a>, 
          Licensed under the Apache License, Version 2.0. All Rights Reserved.
          | <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a><br>
          Apache DataSketches, Apache, the Apache feather logo, and the Apache DataSketches project logos are trademarks of The Apache Software Foundation.<br>
          All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </div>

    </div>
  </div>
</footer>
<!-- End _include/page_footer.html -->

</body>

</html>
<!-- End _layouts/doc_page.html-->